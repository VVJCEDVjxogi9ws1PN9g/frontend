const RPC_URL="https://speedy-nodes-nyc.moralis.io/c8f7991de321be9413884a31/polygon/mainnet",CHAIN_ID=137,CONTRACT_ADDRESSES={land:"0x8Eb4713EA637654627840e7f6028896a5F372AaF",btc:"0xf1bb1BAfB2CDe7D9098378551df64A11f08905B5",ltc:"0x0ed89847e620AFE0Df0cDa9b071bf183d443E1f0",etc:"0x214AD06A3d460A37F788B534D34BCe7d8F24fe46"};async function loadWeb3(){window.web3=new Web3(new Web3.providers.HttpProvider(RPC_URL)),window.ethereum&&(window.ethSupported=!0)}function setLastConnection(t){localStorage.setItem("LCT",t)}function getLastConnection(){return localStorage.getItem("LCT")}function deleteLastConnection(){localStorage.removeItem("LCT")}function loadContract(t){const e=window.web3,n=bundle.contracts.Land,o=new e.eth.Contract(n.abi,CONTRACT_ADDRESSES.land),a=bundle.contracts.BTC,c=new e.eth.Contract(a.abi,CONTRACT_ADDRESSES.btc),s=bundle.contracts.LTC,d=new e.eth.Contract(s.abi,CONTRACT_ADDRESSES.ltc),r=bundle.contracts.ETC,i=new e.eth.Contract(r.abi,CONTRACT_ADDRESSES.etc);window.contracts={land:{contract:o,address:CONTRACT_ADDRESSES.land},btc:{contract:c,address:CONTRACT_ADDRESSES.btc},ltc:{contract:d,address:CONTRACT_ADDRESSES.ltc},etc:{contract:i,address:CONTRACT_ADDRESSES.etc}};const l=getLastConnection();1==l?t.connectWeb3():0==l&&t.connectWC()}function toEth(t){return"string"!=typeof t&&(t=t.toString()),window.web3.utils.fromWei(toFixed2(t))}function toWei(t){return"string"!=typeof t&&(t=t.toString()),window.web3.utils.toWei(t)}function toFixed2(t){var e;Math.abs(t)<1?(e=parseInt(t.toString().split("e-")[1]))&&(t*=Math.pow(10,e-1),t="0."+new Array(e).join("0")+t.toString().substring(2)):(e=parseInt(t.toString().split("+")[1]))>20&&(e-=20,t/=Math.pow(10,e),t+=new Array(e+1).join("0"));return t}function getShortAccount(t){return`${t.substr(0,4)}...${t.substr(t.length-4,4)}`}function formatBalance(t){return`${Number(toEth(t)).toFixed(3)} MATIC`}function loadBalance(t,e){null!=t.account?window.web3.eth.getBalance(t.account.address.full).then(n=>{n=parseInt(n),t.account.balance={wei:n,formatted:formatBalance(n)},t.$apply(),e||setLoadBalanceTimeout(t)}).catch(n=>{e||setLoadBalanceTimeout(t)}):e||setLoadBalanceTimeout(t)}function setLoadBalanceTimeout(t){setTimeout(()=>{loadBalance(t,!1)},2e4)}async function getMyLands(t){let e=await window.contracts.land.contract.methods.getMyLands(t.account.address.full).call();e=e.filter(t=>t>0),t.account.lands=e;let n=await window.contracts.land.contract.methods.getMyLandStatuses(t.account.address.full).call();n=n.filter(t=>t>0),t.dbLands=[];for(let o=0;o<e.length;o++)t.dbLands.push({id:e[o],status:n[o]});t.$apply()}window.usingInjected=!1;const REQUEST_POINT_GROUP_SPACE=2e3;async function getStatus2(t){const e={};for(i=0;i<t.length;i+=4){const n=t[i+2],o=Math.floor(n/REQUEST_POINT_GROUP_SPACE);e.hasOwnProperty(o)?e[o].push(t[i],t[i+1],t[i+2],t[i+3]):e[o]=[t[i],t[i+1],t[i+2],t[i+3]]}let n={};for(let t in e){const o=await getStatus4(e[t]);n={...n,...o}}return n}async function getStatus4(t){let e,n;for(i=0;i<t.length;i+=4){const o=t[i+2];0==i?(e=o,n=o):(o<e&&(e=o),o>n&&(n=o))}const o=await window.contracts.land.contract.methods.getStatus(e,n).call(),a={};for(let t=0;t<o.length;t++)a[e+t]=o[t];return a}const REQUEST_POINT_LIMIT=1e4;async function getStatus(t){let e,n;for(i=0;i<t.length;i+=4){const o=t[i+2];0==i?(e=o,n=o):(o<e&&(e=o),o>n&&(n=o))}const o=[],a=n;let c=n-e;for(;c>0;){let t=e,s=n;c>REQUEST_POINT_LIMIT&&(s=(t=(n=e+REQUEST_POINT_LIMIT-1)+1)+REQUEST_POINT_LIMIT-1)>a&&(s=a),(await window.contracts.land.contract.methods.getStatus(e,n).call()).forEach(t=>o.push(t)),c-=n-e+1,e=t,n=s}return o}function performTrx(t,e,n,o,a){if(t.account.balance.wei<o)return void toast("Insufficient Balance",!0);const c={to:e,from:t.account.address.full,value:window.web3.utils.toHex(o),data:n,gas:"100000"};let s;s=window.usingInjected?window.ethereum.request({method:"eth_sendTransaction",params:[c]}):window.connector.sendTransaction(c),t.toggleLoader(),s.then(e=>{setTimeout(()=>{checkTrx(t,e,a)},TRX_CHECK_DELAY)}).catch(e=>{toast(e.message,!0),t.toggleLoader(),t.$apply()})}const TRX_CHECK_DELAY=2e3;function checkTrx(t,e,n){window.web3.eth.getTransactionReceipt(e,(o,a)=>{if(o)return t.toggleLoader(),void toast(o,!0);null!=a?(t.toggleLoader(),a.status?(loadBalance(t,!0),t.onTrxResult(n)):toast("Transaction Failed",!0)):setTimeout(()=>{checkTrx(t,e,n)},TRX_CHECK_DELAY)})}const ZERO="0x0000000000000000000000000000000000000000",LAND_BASE_PRICES=["0.1","0.2","0.3"];async function mintLand(t){const e=0==t.checkout.couponCode||t.checkout.couponCode==t.account.address.full?ZERO:t.checkout.couponCode,n=(await window.contracts.land.contract.methods.mintLand(t.sl.id,e)).encodeABI();let o=window.web3.utils.toWei(LAND_BASE_PRICES[getRating(t.sl.id)-1]);e!=ZERO&&(o*=.75),performTrx(t,window.contracts.land.address,n,o,"mintLand")}async function mintMultiple(t,e){const n=0==t.checkout.couponCode||t.checkout.couponCode==t.account.address.full?ZERO:t.checkout.couponCode,o=(await window.contracts.land.contract.methods.mintMultiple(e,n)).encodeABI();let a=e.length*window.web3.utils.toWei(""+LAND_BASE_PRICES[getRating(e[0])-1]);n!=ZERO&&(a*=.75),performTrx(t,window.contracts.land.address,o,""+a,"mintMultiple")}const MINER_PRICES={2:"1.99",3:"2.99",4:"3.99",5:"4.99",6:"5.99",7:"6.99",8:"7.99",9:"8.99",10:"9.99"};async function installMiner(t,e){const n=0==t.checkout.couponCode||t.checkout.couponCode==t.account.address.full?ZERO:t.checkout.couponCode,o=(await window.contracts.land.contract.methods.updateStatus(t.sl.id,e,n)).encodeABI();let a=window.web3.utils.toWei(""+MINER_PRICES[e]);n!=ZERO&&(a*=.75),performTrx(t,window.contracts.land.address,o,a,"installMiner")}async function updateMultiple(t,e,n){const o=0==t.checkout.couponCode||t.checkout.couponCode==t.account.address.full?ZERO:t.checkout.couponCode,a=(await window.contracts.land.contract.methods.updateMultiple(e,n,o)).encodeABI();let c=e.length*window.web3.utils.toWei(""+MINER_PRICES[n]);o!=ZERO&&(c*=.75),performTrx(t,window.contracts.land.address,a,""+c,"updateMultiple")}function getLocationNames(t){const e=new XMLHttpRequest;e.onreadystatechange=(()=>{e.readyState==XMLHttpRequest.DONE&&200==e.status&&(t.landDetails={...JSON.parse(e.responseText),...t.landDetails},t.$apply())}),e.open("GET",`https://vmine.xyz/locations/${t.account.address.full}`,!0),e.send()}async function getOffers(t){const e=[],n=await window.contracts.land.contract.methods.getOffers(t.account.address.full,"0").call(),o=[];n.forEach(t=>{0!=t[0]&&(e.push(t[5]),o.push({id:t[0],tokenId:t[5],amt:t[6],amtFormatted:toEth(t[6])+" MATIC"}))}),t.offersMade=o;const a=await window.contracts.land.contract.methods.getOffers(t.account.address.full,"1").call(),c=[];a.forEach(t=>{0!=t[0]&&c.push({id:t[0],tokenId:t[5],amt:t[6],amtFormatted:toEth(t[6])+" MATIC"})}),t.offersRcvd=c,e.length>0&&postRequest("https://vmine.xyz/select-locations/",{ids:e},(e,n)=>{e||(t.landDetails={...JSON.parse(n),...t.landDetails},t.$apply())})}async function makeOffer(t,e,n){const o=(await window.contracts.land.contract.methods.makeOffer(e)).encodeABI();performTrx(t,window.contracts.land.address,o,toWei(n),"makeOffer")}async function cancelOffer(t,e){const n=(await window.contracts.land.contract.methods.cancelOffer(e)).encodeABI();performTrx(t,window.contracts.land.address,n,"0","cancelOffer")}async function acceptOffer(t,e){const n=(await window.contracts.land.contract.methods.acceptOffer(e)).encodeABI();performTrx(t,window.contracts.land.address,n,"0","acceptOffer")}async function loadRewardsData(t,e){let n="";e>=2&&e<=4?n="etc":e>=5&&e<=7?n="ltc":e>=8&&e<=10&&(n="btc");const o=await window.contracts[n].contract.methods.rewardData(t.account.address.full,e).call();t.dbRewards[e-2].claimed=toEth(o[0]),t.dbRewards[e-2].pending=toEth(o[1]),0==o[1]&&0!=o[3]&&(t.dbRewards[e-2].wating=!0,t.dbRewards[e-2].waitFor=getWaitingTime(1e3*o[2],1e3*o[3])),t.$apply()}function getWaitingTime(t,e){const n=e;0!=t&&t>e&&(n=t);const o=n-(new Date).getTime()+864e5;return`In ${Math.floor(o/1e3/60/60)} hrs`}async function claimReward(t,e){let n="";e>=2&&e<=4?n="etc":e>=5&&e<=7?n="ltc":e>=8&&e<=10&&(n="btc");const o=(await window.contracts[n].contract.methods.claimReward(e)).encodeABI();performTrx(t,window.contracts[n].address,o,0,"claimReward")}function postRequest(t,e,n){const o=new XMLHttpRequest;o.open("POST",t),o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify(e)),o.onreadystatechange=(()=>{o.readyState==XMLHttpRequest.DONE&&200==o.status&&n(null,o.responseText)})}function getRequest(t,e){const n=new XMLHttpRequest;n.onreadystatechange=(()=>{n.readyState==XMLHttpRequest.DONE&&(200==n.status?e(null,JSON.parse(n.responseText)):e(`ERROR ${n.status}`,null))}),n.open("GET",t,!0),n.send()}const RATING_BREAKPOINTS=[207974,516027,1015195];function getRatingIndex(t){return t<=RATING_BREAKPOINTS[0]?0:t<=RATING_BREAKPOINTS[1]?1:2}function getRating(t){return t<=RATING_BREAKPOINTS[0]?3:t<=RATING_BREAKPOINTS[1]?2:1}function getSelectNames(t,e){postRequest("https://vmine.xyz/select-locations/",{ids:e},(e,n)=>{e||(t.landDetails={...JSON.parse(n),...t.landDetails},t.$apply())})}